{% extends 'funix/base.html' %} 

{% block media %}
  {{ form.media.css }}
  <link rel="stylesheet" href="{{ static('funix/css/lib/jquery-ui.css') }}">
  <link rel="stylesheet" href="{{ static('plugins/css/resizable.min.css') }}" />

  {# problem specific css #}
  <link rel="stylesheet" href="{{ static('funix/css/loading.css') }}" />
  <link rel="stylesheet" href="{{ static('funix/css/problem/base.css') }}" />
  <link rel="stylesheet" href="{{ static('funix/css/problem/sidebar.css') }}" />
  <link rel="stylesheet" href="{{ static('funix/css/problem/problem-content.css') }}" />
  <link rel="stylesheet" href="{{ static('funix/css/problem/topbar.css') }}" />
  <link rel="stylesheet" href="{{ static('funix/css/problem/main-middle.css') }}" />
  <link rel="stylesheet" href="{{ static('funix/css/problem/description.css') }}" />
  <link rel="stylesheet" href="{{ static('funix/css/problem/metadata.css') }}" />
  <link rel="stylesheet" href="{{ static('funix/css/problem/problem.css') }}" />
  <link rel="stylesheet" href="{{ static('funix/css/problem/html-preview.css') }}" />
  <link rel="stylesheet" href="{{ static('funix/css/problem/submission-history.css') }}" />
  <link rel="stylesheet" href="{{ static('funix/css/problem/modal.css') }}" />

  <style>
    {% if is_html %}
      #main-right {
        flex: 1;
        border-left: .5px solid var(--border);
      }

      @media screen and (max-width: 992px) {
        #main-right {
          border-left: none;
        }
      }
    {% else %}
      #main-middle {
        flex: 1;
      }
    {% endif %}

    {% if not request.user.is_authenticated %}
        #main-left, #main-middle {
          flex: 1;
        }
    {% endif %}
  </style>
{% endblock %} 

{% block js_media %}
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-chtml.min.js"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
  <script src="{{static('plugins/js/resizable.min.js')}}" type="text/javascript"></script>
  <script type="text/javascript" src="{{ ACE_URL }}/ace.js"></script>
  {{ form.media.js }} 


  
  <script type="text/javascript">
    {% if is_html %}
    function update_iframe_height() {
      const iframe = document.querySelector("#html-preview iframe");
      iframe.style.height = 0;
      iframe.style.height = iframe.contentWindow.document.documentElement.scrollHeight + 20 + 'px';
    }
    {% endif %}

    function init_tabs() {
      $( "#beta-container" ).tabs();
      $( "#testcases").tabs();
      $( ".testcases-and-submission").tabs();
    }
  </script>

  {% compress js %} 
    {% include 'funix/problem/ace-editor.html' %} 
  {% endcompress %}

  <script type="text/javascript" src="{{ static('event.js') }}"></script>

{% if submission and not submission.is_graded and last_msg %} {% include "funix/problem/js-event.html" %} {% endif %} 
  {% if submission and not submission.is_graded %}
    <script type="text/javascript">
      $(function () {
        $(document).keydown(function (e) {
          // Ctrl-Enter or Command-Enter
          if ((e.metaKey || e.ctrlKey) && e.which == 13) {
            $("#abort-button form").submit();
          }
        });
      });
    </script>
  {% endif %} 
{% endblock %} 

{% if submission %} 
  {% set is_processing = submission is not none %} 
{% endif %}

{% block body %}
<div id="problem-container" >
  <div id="sidebar-wrapper">
    {% include "funix/problem/sidebar.html" %}
  </div>

  <div id="problem-content-wrapper">
    {% include "funix/problem/content.html" %}
  </div>

  {% if  submission and  not submission.is_graded and (request.user == submission.user.user or perms.judge.abort_any_submission) %}
    <div id="loading-modal" class="backdrop">
      <div style="min-width: 500px;" class="modal">
        <p style="text-align: center; font-size: 20px;">{{ _('Judging') }}</p>
        <div style="display: flex; align-items: center; justify-content: center;"><div class="lds-dual-ring"></div></div>
        <form style="display: flex; align-items:center; justify-content: center; padding-top: 20px;" action="{{ url('beta_submission_abort', submission.id) }}" method="post"
          title="{{ _('Press Ctrl-Enter or Command-Enter to abort.') }}">
          {% csrf_token %}
          <input type="submit" value="{{ _('Abort') }}" class="button"/>
        </form>
      </div>
    </div>
{% endif %}
</div>


{% if request.user.is_authenticated %}
{% include "funix/problem/js-resizing.html" %} 
{% endif %}
  

<script>
  init_tabs();

  function closeSuccessModal() {
    $("#success-modal").css("display", "none")
  }
</script>

{% endblock %}
