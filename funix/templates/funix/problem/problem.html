{% extends 'funix/base.html' %} 

{% block media %} 
  {{ form.media.css }}
  <link rel="stylesheet" href="{{ static('funix/css/lib/jquery-ui.css') }}" />
  <link rel="stylesheet" href="{{ static('plugins/css/resizable.min.css') }}" />

  {# problem specific css #}
  <link rel="stylesheet" href="{{ static('funix/css/loading.css') }}" />
  <link rel="stylesheet" href="{{ static('funix/css/problem/base.css') }}" />
  <link rel="stylesheet" href="{{ static('funix/css/problem/sidebar.css') }}" />
  <link
    rel="stylesheet"
    href="{{ static('funix/css/problem/problem-content.css') }}"
  />
  <link rel="stylesheet" href="{{ static('funix/css/problem/topbar.css') }}" />
  <link
    rel="stylesheet"
    href="{{ static('funix/css/problem/main-middle.css') }}"
  />
  <link
    rel="stylesheet"
    href="{{ static('funix/css/problem/description.css') }}"
  />
  <link rel="stylesheet" href="{{ static('funix/css/problem/metadata.css') }}" />
  <link rel="stylesheet" href="{{ static('funix/css/problem/problem.css') }}" />
  <link
    rel="stylesheet"
    href="{{ static('funix/css/problem/html-preview.css') }}"
  />
  <link
    rel="stylesheet"
    href="{{ static('funix/css/problem/submission-history.css') }}"
  />
  <link rel="stylesheet" href="{{ static('funix/css/problem/modal.css') }}" />

  <style>
    {% if is_html %}
      #main-right {
        flex: 1;
        border-left: .5px solid var(--border);
      }

      @media screen and (max-width: 992px) {
        #main-right {
          border-left: none;
        }
      }
    {% else %}
      #main-middle {
        flex: 1;
      }
    {% endif %}

    {% if not request.user.is_authenticated %}
        #main-left {
          flex: 1;
          order: 1;
        }

        #login-required {
          order: 2;
          height: 100%;
          display: flex;
          align-items: center;
          justify-content: center;
          flex: 1;
          border-left: .5px solid var(--border);
        }

        @media screen and (max-width: 992px) {
          #login-required {
            height: 300px;
            border-left: none;
            border-bottom: .5px solid var(--border);
          }
        }
    {% endif %}
  </style>
{% endblock %} 

{% block js_media %}
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-chtml.min.js"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
  <script src="{{static('plugins/js/resizable.min.js')}}" type="text/javascript"></script>
  <script type="text/javascript" src="{{ ACE_URL }}/ace.js"></script>
  {{ form.media.js }}
  <script type="text/javascript" src="{{ static('event.js') }}"></script>

  {% include 'funix/problem/ace-editor.html' %}

  {% if request.user.is_authenticated %}

    {% if is_html %}
      <script type="text/javascript">
        function update_iframe_height() {
          const iframe = document.querySelector("#html-preview iframe");
          iframe.style.height = 0;
          iframe.style.height = iframe.contentWindow.document.documentElement.scrollHeight + 20 + 'px';
        }
      </script>
    {% endif %}

    {% include "funix/problem/js-resizing.html" %} 
  
  {% endif %}

    {% include "funix/problem/js-tabs.html" %}

  {% if submission and not submission.is_graded and last_msg %} 
    {% include "funix/problem/js-event.html" %} 
  {% endif %} 

{% endblock %} 

  {% if submission %}
    {% set is_processing = submission is not none %} 
  {% endif %} 

{% block body %}
<div id="problem-container">
  <div id="sidebar-wrapper">{% include "funix/problem/sidebar.html" %}</div>

  <div id="problem-content-wrapper">
    <div id="problem-content">
      <div id="topbar">{% include "funix/problem/topbar.html" %}</div>

      <div id="main">
        {% if not request.user.is_authenticated %} {% include
        "funix/problem/login-required.html" %} {% endif %}

        <div id="main-left">
          {% include "funix/problem/details.html" %} {% include
          "funix/submission/history.html" %}
        </div>

        {% if request.user.is_authenticated %}
        <div id="main-middle">
          {% include 'funix/problem/editor.html' %} {% include
          'funix/submission/submission.html' %}
        </div>

        <script> 
          console.log("rendered editor")
        </script>

        {% if is_html %}
        <div id="main-right">
          {% include "funix/problem/html-preview.html" %}
        </div>
        {% endif %} 
        {% endif %}
      </div>
    </div>
  </div>

  {% if submission and not submission.is_graded and (request.user == submission.user.user or perms.judge.abort_any_submission) %} 
    {% include "funix/problem/judging-modal.html" %} 
  {% endif %}
</div>

{% endblock %}
