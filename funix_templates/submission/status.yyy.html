{% extends 'base.html' %}

{% block media %}
    {{ form.media.css }}
    <link rel="stylesheet" href="{{ static('plugins/css/resizable.min.css') }}">
    <link rel="stylesheet" href="{{ static('override/css/problem.css') }}">
{% endblock %}


{% block js_media %}
    <script src="{{static('plugins/js/resizable.min.js')}}" type="text/javascript"></script>
    <script type="text/javascript" src="{{ ACE_URL }}/ace.js"></script>
    {{ form.media.js }}

    {% compress js %}
        <script type="text/javascript">
            $(function () {
                function format(state) {
                    if (!state.id) return state.text; // optgroup
                    return state.text;
                }

                window.previous_template = '';

                function update_language_template() {
                    var source = $('textarea#id_source');
                    if (source.val() == window.previous_template.replace(/\r/g, '') || source.val() == '') {
                        var lang_id = $('#id_language').val();
                        var code = localStorage.getItem('submit:' + $('#id_language').val());

                        function update_submit_area(code) {
                            window.previous_template = code;
                            source.val(code);
                            window.ace_source.getSession().setValue(code);
                        }

                        if (code != null) {
                            update_submit_area(code);
                        } else {
                            $.get('{{ url('language_template_ajax') }}', {
                                id: lang_id
                            }).done(function (template) {
                                update_submit_area(template);
                            });
                        }
                    }
                }

                function makeDisplayData(data) {
                    var site_data = data.attr('data-info');
                    var judge_data = data.attr('data-judge-info');
                    var display_data = site_data || judge_data;
                    return display_data;
                }

                function formatSelection(state) {
                    if (!state.id) return state.text; // optgroup
                    var data = makeDisplayData($("option[data-id=" + state.id + "]"));
                    return $('<span>').append($('<b>').text(state.text), ' (', data, ')');
                }

                // Terrible hack, adapted from https://github.com/select2/select2/issues/4436
                $.fn.select2.amd.define('select2/data/customAdapter', ['select2/results', 'select2/utils'], function (Result, Utils) {
                    RefPresenter = function ($element, options, dataAdapter) {
                        RefPresenter.__super__.constructor.call(this, $element, options, dataAdapter);
                    };
                    Utils.Extend(RefPresenter, Result);
                    RefPresenter.prototype.bind = function (container, $container) {
                        container.on('results:focus', function (params) {
                            var data = makeDisplayData($("option[data-id=" + params.data.id + "]"));
                            $("#result-version-info").text(data);
                        });
                        RefPresenter.__super__.bind.call(this, container, $container);
                    };
                    return RefPresenter;
                });

                var customAdapter = $.fn.select2.amd.require('select2/data/customAdapter');

                $("#id_language").select2({
                    theme: '{{ DMOJ_SELECT2_THEME }}',
                    templateResult: format,
                    templateSelection: formatSelection,
                    resultsAdapter: customAdapter
                });

                $('#id_language').on('select2:open', function (evt) {
                    var dropdown = $('.select2-dropdown');
                    if (!$('#result-version-info').length)
                        dropdown.append($("<span id=\"result-version-info\">"));
                    dropdown.attr('id', 'language-select2');
                });

                $('#id_judge').on('select2:open', function (evt) {
                    var dropdown = $('.select2-dropdown');
                    $('#result-version-info').remove();
                    dropdown.attr('id', 'judge-select2');
                });

                $('#id_language').change(function () {
                    var lang = $("#id_language").find("option:selected").attr('data-ace');
                    window.ace_source.getSession().setMode("ace/mode/" + lang);
                    update_language_template();
                });

                $('#ace_source').on('ace_load', function (e, editor) {
                    update_language_template();
                    editor.commands.addCommand({
                        name: 'save',
                        bindKey: {win: 'Ctrl-S', mac: 'Command-S'},
                        exec: function () {
                            localStorage.setItem('submit:' + $('#id_language').val(), editor.getSession().getValue());
                        }
                    });
                    editor.getSession().setUseWrapMode(true);
                    editor.setFontSize(14);
                    editor.setPrintMarginColumn(100);
                    editor.focus();
                });

                // uuuuvcomment
                // disable default resize editor 
                // $(window).resize(function () {
                //     $('#ace_source').height(Math.max($(window).height() - 353, 100));
                // }).resize();

                $('#problem_submit').submit(function (event) {
                    if ($('#id_source').val().length > 65536) {
                        alert("{{ _('Your source code must contain at most 65536 characters.') }}");
                        event.preventDefault();
                        $('#problem_submit').find(':submit').attr('disabled', false);
                    }
                });
            });
        </script>
    {% endcompress %}

    <!-- submission js  -->
    
{% endblock %}



{% block body %}
    <div class="problem__topbar">
        <span> {% if content_title %}{{ content_title }}{% else %}{{ title }}{% endif %}</span>
    </div>

    <div class="problem__sidebar">
        
            <a href="#">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
                </svg>   
            </a>
        
            <a href="#">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
                    <path strokeLinecap="round" strokeLinejoin="round" d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zM3.75 12h.007v.008H3.75V12zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm-.375 5.25h.007v.008H3.75v-.008zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
                </svg>       
            </a>       
        
            <a href="#">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </a>
        
            <a href="#">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 01.865-.501 48.172 48.172 0 003.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z" />
                </svg>    
            </a>          
        
            <a href="#">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z" />
                </svg>             
            </a> 
    </div>

    <div class="problem__main">
        <div class="problem__left">
            <div class="problem__generalInfo clearfloat">
                <div class="problem__generalInfo__item problem__author">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
                    </svg>    
                    <a href="#">Username</a>
                </div>

                <div class="problem__generalInfo__item problem__difficultyLevel">Easy</div>

                <div class="problem__generalInfo__item problem__points">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z" />
                    </svg>
                    100 points
                </div>

                <div class="problem__generalInfo__item problem__charactersLimit">
                    Character limit: <span>3000</span>
                </div>
            </div>

            <div class="problem__description">
                <div class="content-description screen">
                    {% cache 86400 'problem_html' problem.id MATH_ENGINE LANGUAGE_CODE %}
                        {{ description|markdown(problem.markdown_style, MATH_ENGINE)|reference|str|safe }}
                    {% endcache %}
            
                    {% with license=problem.license %}
                        {% if license %}
                            <span class="license">
                            <a href="{{ url('license', license.key) }}">{{ license.display or license.name }}</a>
                        </span>
                        {% endif %}
                    {% endwith %}
                </div>
                <a href="#"> If you don't know how to submit your code, see FAQ here.</a>
            </div>
        </div>
    
        <form id="problem_submit"  class="problem__right" method="post" >
            <div class="problem__toolbar">
                <button class="problem__toolbar__expand problem__toolbar__button">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15" />
                    </svg>
                </button>

             

                <button class="problem__toolbar__reset problem__toolbar__button">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
                    </svg>
                      
                    <span>reset</span>
                </button>
            </div>

            {% if not no_judges %}
                <div id="language">
                    {{ form.language.errors }}
                    <div id="language-select">
                        <select id="id_language" name="language">
                            {% for lang in form.fields.language.queryset %}
                                <option value="{{ lang.id }}" data-id="{{ lang.id }}" data-name="{{ lang.name }}"
                                        data-info="{{ lang.info }}" data-ace="{{ lang.ace }}"
                                        data-judge-info="{{ runtime_versions(lang.runtime_versions()) }}"
                                        {% if lang.id == default_lang.id %}selected{% endif %}>{{ lang.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            {% endif %}


            <div class="problem__warning">
                {% if not no_judges %}
                    {% if default_lang not in form.fields.language.queryset %}
                        <div class="alert alert-warning alert-dismissable">
                            <a class="close">x</a>
                            <b>{{ _('Warning!') }}</b>
                            {{ _('Your default language, %(language)s, is unavailable for this problem and has been deselected.', language=bold(default_lang.name)) }}
                        </div>
                    {% endif %}
            
                    {% if request.in_contest and submission_limit %}
                        {% if submissions_left > 0 %}
                            <div class="alert alert-warning alert-dismissable">
                                <a class="close">x</a>
                                {% trans left=submissions_left -%}
                                    You have {{ left }} submission left
                                    {%- pluralize -%}
                                    You have {{ left }} submissions left
                                {%- endtrans %}
                            </div>
                        {% else %}
                            <div class="alert alert-warning alert-dismissable">
                                <a class="close">x</a>
                                {{ _('You have 0 submissions left') }}
                            </div>
                        {% endif %}
                    {% endif %}
                {% endif %}
            </div>

            <div class="problem__editor">
                {% csrf_token %}
                {{ form.non_field_errors() }}
                <div id="submit-wrapper">
                    <div id="editor">
                        {{ form.source.errors }}
                        {{ form.source }}
                    </div>
                </div>
            </div>

            <div class="problem__testcases">
                <div class="problem__judgeAndSubmit">
                    {% if no_judges %}
                        <span style="color: red">{{ _('No judge is available for this problem.') }}</span>
                    {% else %}
                        <div class="submit-bar">
                            <div>
                                {{ form.judge }}
                            </div>
                            <input type="submit" value="{{ _('Submit!') }}" class="button"
                                {% if request.in_contest and submission_limit and not submissions_left %}disabled{% endif %}>
                        </div>
                    {% endif %}
                </div>

                <p class="problem__testcases__title">Test cases</p>

                <div class="problem__testcases__content">
                    <ul class="problem__testcases__nav text-primary col-4">
                        <li>Test case 1</li>
                        <li>Test case 2</li>
                        <li>Test case 3</li>
                        <li>Test case 4</li>
                        <li>Test case 5</li>
                        <li>Test case 6</li>
                        <li>Test case 7</li>
                        <li>Test case 8</li>
                        <li>Test case 9</li>
                        <li>Test case 10</li>
                        <li>Test case 11 lock</li>
                    </ul>   

                    <div class="testcases__details">
                        <ul>
                            <li>
                                <label class="col-4 text-primary">Input:</label>
                                <span class="col-8 text-light">[7, 2, 6, 5, 1, 3],3</span>
                            </li>

                            <li>
                                <label class="col-4 text-primary">Actual output:</label>
                                <span class="col-8 text-light"></span>
                            </li>

                            <li>
                                <label class="col-4 text-primary">Expected output:</label>
                                <span class="col-8 text-light">[7, 6, 6, 5]</span>
                            </li>

                            <li>
                                <label class="col-4 text-primary">Execute time limit:</label>
                                <span class="col-8 text-light">3000 ms</span>
                            </li>

                            <li>
                                <label class="col-4 text-primary">Execute time:</label>
                                <span class="col-8 text-light"></span>
                            </li>

                            <li>
                                <label class="col-4 text-primary">Message:</label>
                                <span class="col-8 text-light"></span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

        </form>
    </div>


    <script>
        $('.problem__left').resizable({
            direction: ['right']
        })

        $('.problem__testcases').resizable({
            direction: ['top']
        })
    </script>
{% endblock %}